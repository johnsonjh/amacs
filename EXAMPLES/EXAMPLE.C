/* -*- Mode: C -*- *//* The following code kills a named process running in the Unix environment. * Special thanks to Guy Washburn for his Fortune Systems version. */#include <stdio.h>#include <signal.h>/* Kill a named process. *  * This is really pretty easy.  We invoke the process reporter "ps -a" and * pipe its output right into our input.  Then we read from this stream until * we find the process named as the initial argument.  Once found, strip out * the process id number, and KILL it with a system call.  Simple, huh? * * Actually, this version isn't that smart.  It prompts the user for each * process whether or not to kill it.  Oh well. */char *progname;			/* Program name for error messages */char *ps = "ps -a";		/* Name of the process reporter. */main (argc, argv)		/* Start of program */   int argc;   char *argv[];{   FILE *fin, *popen ();	/* popen() returns a file pointer */   char buf[BUFSIZ];   int pid;      progname = argv[0];   if ((fin = popen (ps, "r")) == NULL) {      fprintf (stderr, "%s: can't run %s\n", progname, ps);      exit (1);   }      /* read a single line from the process */   while (fgets (buf, sizeof (buf), fin) != NULL) {          /* ask user if they wish to kill this one */     if (argc == 1 || strindex (buf, argv[1]) >= 0) {       buf[strlen (buf) - 1] = '\0';	/* suppress carriage return */       fprintf (stderr, "%s? ", buf);       if (ttyin () == 'y') {         sscanf (buf, "%d", &pid);	 kill (pid, SIGKILL);       }     }   }   exit (0); }ttyin ()			/* Process response from /dev/tty */{    char buf[BUFSIZ];    FILE *efopen ();    static FILE *tty = NULL;        if (tty == NULL) tty = efopen ("/dev/tty", "r");        for (;;) {      if (fgets (buf, BUFSIZ, tty) == NULL || tolower(buf[0]) == 'q')         exit (0);      else                /* we even let the user type in a shell command, by prefixing	    it with "!" */         if (buf[0] == '!') {	   system (buf+1);	   printf ("!\n");	 }	 else return (tolower(buf[0]));    }}FILE *efopen(file, mode)	/* Open a file, die if can't. */    char *file, *mode;{    FILE *fp, *fopen ();    extern char *progname;        if ((fp = fopen (file, mode)) != NULL) return fp;        fprintf (stderr,"%s: can't open file %s, mode %s\n",             progname, file, mode);    exit (1);}strindex (s, t)			/* return index of t in s , -1 if none */    char *s, *t;{    int i, n = strlen (t);    /* map over s, looking for t */    for (i = 0; s[i]; i++)        if (strncmp (s+i, t, n) == 0) return (i);	    return (-1);}