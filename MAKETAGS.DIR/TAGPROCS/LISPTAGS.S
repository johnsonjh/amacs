;-*- Mode: Merlin -*-;; File: LispTags.;; This file contains the routines necessary to process Lisp; source code files for AMACS tags.; put defs/maketags.equs org UserFuncAddr dsk bin/lisptags use macros/standard; da NullVect ;jump here for start file processing. da LispTag? ;jump here for IsTag? and tag processing. da NullVect ;jump here for end-of-file processing.;NullVect rts; put tagprocs/tag.subs;LispTag? equ *  ;check LineBuff for Lisp tag. lda LineBuff beq :fail ;no text, no tag.; lda LineBuff+1 cmp #"(" ;have to hack top level lists in column 0. bne :fail ;a tag begins with an alpha char.; ldx #$01 stx LineIndex; jsr NextToken ;get the current token. load temp;TagExt jsr MoveToken ;save tag prefix.; jsr NextToken ;get name of var/function. load temp;Tag jsr MoveToken ldy Tag  ;get length of token just moved. iny lda #"!" sta Tag,y iny; ldx #$01 ;move the prefix portion.:movtag lda TagExt,x sta Tag,y cpx TagExt bcs :done inx iny bne :movtag;:done sty Tag lda #$00 rts;:fail lda #$FF ;fail, not a valid tag. rts;TagExt ds 64;